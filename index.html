<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>Utleide malerier – live tracking</title>

  <!-- Leaflet CSS (CDN) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin="anonymous"
  />

  <style>
    /* Fullscreen, ren og filmvennlig look */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #0b0c0e; /* bakgrunn hvis kart ikke har lastet */
    }
    #map {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      /* backface-visibility: hidden;
      transform: translateZ(0);  */
    }
    
    /* Unngå hvitt når fliser ikke er lastet / under zoom */
    #map,
    .leaflet-container,
    .leaflet-pane,
    .leaflet-layer {
        background: #0b0c0e; /* match resten av UI-et ditt */
    }
    .leaflet-tile {
        background-color: #0b0c0e !important; /* bakgrunn bak selve tile-bildet */
    }

    /* Minimal UI – flytende bar med tittel og fullscreen-knapp */
    .topbar {
      position: fixed;
      top: env(safe-area-inset-top, 12px);
      left: 12px;
      right: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: rgba(18, 18, 22, 0.6);
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 10px 12px;
      z-index: 5000;
      color: #eaeaea;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      font-size: 14px;
      line-height: 1.2;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      opacity: 0.95;
      font-weight: 600;
      letter-spacing: 0.2px;
    }
    .brand-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #f45;
      box-shadow: 0 0 0 2px rgba(255, 68, 85, 0.3);
    }
    .btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: #fff;
      border-radius: 10px;
      padding: 8px 10px;
      font: inherit;
      cursor: pointer;
    }
    .btn:active { transform: translateY(1px); }

    /* Leaflet tweaks – bare zoomkontroller, liten attribution */
    .leaflet-control-attribution {
      background: rgba(18,18,22,0.6) !important;
      color: #bdbdbd !important;
      border-radius: 10px !important;
      padding: 2px 6px !important;
      font-size: 10px !important;
      border: 1px solid rgba(255,255,255,0.08) !important;
    }
    .leaflet-control-zoom a {
      background: rgba(18,18,22,0.7);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: none;
    }
    .leaflet-control-zoom a:hover { background: rgba(18,18,22,0.9); }

    /* Minimal markør som pulserer svakt (filmvennlig) */
    .pulse-marker {
      width: 14px;
      height: 14px;
      background: #ff4455;
      border: 2px solid #fff;
      border-radius: 50%;
      box-shadow: 0 0 0 0 rgba(255,68,85,0.7);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255,68,85,0.6); }
      70% { box-shadow: 0 0 0 16px rgba(255,68,85,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,68,85,0); }
    }

    /* Popup med litt typografi */
    .art-popup {
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: #111;
    }
    .art-popup h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      line-height: 1.2;
    }
    .art-popup img {
      width: 220px;
      max-width: 70vw;
      height: auto;
      border-radius: 10px;
      display: block;
      border: 1px solid #ddd;
    }

    /* iOS safe-area help */
    @supports (padding: max(0px)) {
      .topbar { padding-top: max(10px, env(safe-area-inset-top)); }
    }
  </style>
</head>
<body>
  <div id="map" role="application" aria-label="Kart over sporingspunkter for malerier"></div>

  <div class="topbar">
    <div class="brand">
      <span class="brand-dot" aria-hidden="true"></span>
      <span>Utleide malerier – Live</span>
    </div>
    <div style="display:flex; gap:8px;">
      <button class="btn" id="btnFit">Zoom til alle</button>
      <button class="btn" id="btnLocate">⦿</button>
    </div>
  </div>

  <!-- Leaflet JS (CDN) -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="anonymous"
  ></script>

  <script>
    // ====== Basiskart (minimal detaljer) med Carto "dark_nolabels" ======
    // Merk: Krever internett-tilgang til tile-server. Attribution beholdes.
    const map = L.map('map', {
        zoomControl: true,
        scrollWheelZoom: true,
        dragging: true,
        tap: true,
        zoomAnimation: false,       // slå av zoom-animasjon (fjerner mye flimmer)
        markerZoomAnimation: false, // markers hopper ikke
        fadeAnimation: true,
        zoomControl: false
    });

    // Be Leaflet forsøke å finne brukerens posisjon (via Geolocation API)
    map.locate({
        //setView: true,      // zoom kartet til brukerens posisjon automatisk
        maxZoom: 7,        // ikke zoom for langt inn
        enableHighAccuracy: true,
        timeout: 8000,      // avbryt etter 8 sekunder
        maximumAge: 0
    });

    let myPosition;
    let myCircle;
    // Når posisjonen er funnet
    map.on('locationfound', (e) => {
        const radius = e.accuracy / 2;
        myPosition = e.latlng
        console.log('myPos: ', myPosition)
        // Marker brukerens posisjon
        myCircle = L.circleMarker(e.latlng, {
            radius: 8,
            fillColor: '#4fc3f7',
            color: '#fff',
            weight: 2,
            opacity: 1,
            fillOpacity: 0.9
        }).addTo(map);

        // Tegn en sirkel for presisjonsradius
        // L.circle(e.latlng, {
        //     radius: radius,
        //     color: '#4fc3f7',
        //     weight: 1,
        //     opacity: 0.3,
        //     fillOpacity: 0.1
        // }).addTo(map);

        // Popup for brukerens posisjon
        //   userMarker.bindPopup(`Du er her (±${Math.round(radius)} m)`).openPopup();
    });

    // Hvis noe går galt (f.eks. bruker nekter tilgang)
    map.on('locationerror', (e) => {
    console.warn('Kunne ikke finne posisjon:', e.message);
         console.log('Kunne ikke finne din posisjon – sjekk at du har gitt tilgang til posisjon.');
    });



    const tiles = L.tileLayer(
    // 'https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', // mørk
    // 'https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', // lys minimalistisk
    // 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', // lys med markers
    'https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png',
      {
        maxZoom: 19,
        keepBuffer: 6,            // behold flere tile-ringer utenfor skjerm
        updateWhenZooming: false,
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> ' +
          '& <a href="https://carto.com/attributions">CARTO</a>',
        noWrap: true,         // ikke gjenta verden horisontalt
        bounds: [[-85,-180],[85,180]] // begrens til projeksjonsområde
    }).addTo(map);

    const points = [
    {
        artwork: "Vinternatt",
        location: "Hamburger Kunsthalle",
        coords: [53.5552936, 10.0030010953872],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/de/Edvard_Munch_-_Winter_Night_-_MM.M.00456_-_Munch_Museum.jpg/330px-Edvard_Munch_-_Winter_Night_-_MM.M.00456_-_Munch_Museum.jpg"
    },
    {
        artwork: "Natt i Saint Cloud",
        location: "Guggenheim Bilbao Museum",
        coords: [43.2691, -2.9340],  // estimat for Guggenheim Bilbao
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Edvard_Munch_-_Night_in_Saint-Cloud_%281890%29%2C_NG.M.01111.jpg/500px-Edvard_Munch_-_Night_in_Saint-Cloud_%281890%29%2C_NG.M.01111.jpg"
    },
    {
        artwork: "Vampyr",
        location: "Hjemme",
        coords: [59.90953131942386, 10.523799997891706],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Edvard_Munch_-_Vampire_%281895%29_-_Google_Art_Project.jpg/960px-Edvard_Munch_-_Vampire_%281895%29_-_Google_Art_Project.jpg"
    },
    {
        artwork: "Aften på Karl Johan",
        location: "Berlinische Galerie",
        coords: [52.5039, 13.39823],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Evening_on_Karl_Johan_Street.jpg/330px-Evening_on_Karl_Johan_Street.jpg"
    },
    {
        artwork: "På operasjonsbordet",
        location: "Berlinische Galerie",
        coords: [52.5039, 13.39823],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Edvard_Munch_-_On_the_Operating_Table_-_MM.M.00022_-_Munch_Museum.jpg/330px-Edvard_Munch_-_On_the_Operating_Table_-_MM.M.00022_-_Munch_Museum.jpg"
    },
    {
        artwork: "Dødskamp",
        location: "National Museum in Warsaw",
        coords: [52.23167, 21.02472],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/Edvard_Munch%2C_Dødskamp.JPG/330px-Edvard_Munch%2C_Dødskamp.JPG"
    },
    {
        artwork: "Madonna",
        location: "National Museum in Warsaw",
        coords: [52.23167, 21.02472],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Edvard_Munch_-_Madonna_-_Google_Art_Project.jpg/250px-Edvard_Munch_-_Madonna_-_Google_Art_Project.jpg"
    },
    {
        artwork: "Marats død",
        location: "Birmingham Museum & Art Gallery",
        coords: [52.4788, -1.8960],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/Edvard_Munch_-_The_Death_of_Marat_-_MM.M.00351_-_Munch_Museum.jpg/330px-Edvard_Munch_-_The_Death_of_Marat_-_MM.M.00351_-_Munch_Museum.jpg"
    },
    {
        artwork: "Kvinnen",
        location: "Manchester Art Gallery",
        coords: [53.4808, -2.2379],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Edvard_Munch_-_Woman_-_MM.M.00375_-_Munch_Museum.jpg/330px-Edvard_Munch_-_Woman_-_MM.M.00375_-_Munch_Museum.jpg"
    },
    {
        artwork: "Døden i sykeværelset",
        location: "Musée Matisse",
        coords: [43.2886, 5.3840],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Edvard_Munch_-_Death_in_the_Sickroom.jpg/330px-Edvard_Munch_-_Death_in_the_Sickroom.jpg"

    },
    {
        artwork: "Fortvilelse",
        location: "Trondheim kunstmuseum",
        coords: [63.4270, 10.3951],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/61/Edvard_Munch_-_Despair_%281894%29.jpg/250px-Edvard_Munch_-_Despair_%281894%29.jpg"
    },
    {
        artwork: "Døden og barnet",
        location: "Munch-museet",
        coords: [59.9070, 10.7525],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/ce/Munch%2C_The_dead_mother_and_the_child.jpg/330px-Munch%2C_The_dead_mother_and_the_child.jpg"
    },
    {
        artwork: "Angst",
        location: "Henie Onstad Kunstsenter",
        coords: [59.8797, 10.4380],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/ae/Edvard_Munch_-_Anxiety_-_Google_Art_Project.jpg/250px-Edvard_Munch_-_Anxiety_-_Google_Art_Project.jpg"
    },
    {
        artwork: "Selvportrett i helvette",
        location: "Budapest",
        coords: [47.4979, 19.0402],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Edvard_Munch_-_Self-Portrait_in_Hell_-_Google_Art_Project.jpg/250px-Edvard_Munch_-_Self-Portrait_in_Hell_-_Google_Art_Project.jpg"
    },
    {
        artwork: "Døden og barnet",
        location: "Museum voor Schone Kunsten Gent",
        coords: [51.0569, 3.7174],
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Edvard_Munch_-_Death_and_the_Child_%281899%29%2C_Kunsthalle_Bremen.jpg/250px-Edvard_Munch_-_Death_and_the_Child_%281899%29%2C_Kunsthalle_Bremen.jpg"
    }
    ];

    // DivIcon for ren, pulserende markør
    const dotIcon = L.divIcon({
      className: 'pulse-marker',
      iconSize: [14, 14],
      iconAnchor: [7, 7]
    });

    // Legg til markører og popups
    const markers = points.map(p => {
      const m = L.marker(p.coords, { icon: dotIcon }).addTo(map);
      const popupHtml = `
        <div class="art-popup">
          <h3>${p.artwork}</h3>
          <p>${p.location}<p/>
          <img alt="Maleribilde for ${p.artwork}" src="${p.img}">
        </div>`;
      const POPUP_OPTS = {
        autoPan: true,
        keepInView: true,
        // justér tallene til høyden/bredden på topbaren din
        autoPanPaddingTopLeft: [12, 80],
        autoPanPaddingBottomRight: [12, 12],
        closeButton: true
      };
      m.bindPopup(popupHtml, POPUP_OPTS);
      return m;
    });

    // Fit til alle punkter ved oppstart
    const group = L.featureGroup(markers);
    map.fitBounds(group.getBounds().pad(0.2));

    // UI-knapper
    document.getElementById('btnFit').addEventListener('click', () => {
      map.fitBounds(group.getBounds().pad(0.2));
    });

    // Fullscreen toggle
    const mapEl = document.getElementById('map');
    function locateMe() {
        console.log(myCircle)
        myCircle.setStyle({ opacity: 0, fillOpacity: 0 })
        if (myPosition) {
            map.flyTo(
                myPosition,
                10,
                { duration: .5 }
            )
        } else {
            console.log("myPosition is unknown: ", myPosition)
        }
          map.once('zoomend', () => {
            myCircle.setStyle({ 
              opacity: 1,
              fillOpacity: 0.9
            });
        });
    }
    document.getElementById('btnLocate').addEventListener('click', locateMe);

    // Dobbelttrykk for fullskjerm (mobil)
    // let lastTap = 0;
    // mapEl.addEventListener('touchend', () => {
    //   const now = Date.now();
    //   if (now - lastTap < 350) locateMe();
    //   lastTap = now;
    // }, { passive: true });
  </script>
</body>
</html>